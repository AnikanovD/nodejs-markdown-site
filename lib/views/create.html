<!DOCTYPE html>
<html lang="en">
<head>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'/>
    <meta charset="UTF-8">

    <link rel="stylesheet" href="/markdown-knowledge-base/codemirror/css/codemirror.css">
    <link rel="stylesheet" href="/markdown-knowledge-base/markdown/css/markdown.css">
    <link rel="stylesheet" href="/markdown-knowledge-base/markdown/css/kotlin-site-default.css">
    <link rel="stylesheet" href="/markdown-knowledge-base/markdown/css/kotlin-site-common.css">
    <link rel="stylesheet" href="/markdown-knowledge-base/materialize/css/materialize.css">
    <link rel="stylesheet" href="/markdown-knowledge-base/site/css/styles.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <title>Add new article | Markdown Website</title>
</head>
<body>
<nav>
    <div class="nav-wrapper hide-on-med-and-up">
        <a href="#" data-target="nav-mobile" class="sidenav-trigger left"><i class="material-icons">menu</i></a>
        <a class="right brand-logo" id="logo-mobile">Markdown Knowledge Base</a>
        <ul id="nav-mobile" class="sidenav left">
            <li><a href="/markdown-knowledge-base">Home</a></li>
            <li class="active"><a>Add new article</a></li>
            <li><a href="/markdown-knowledge-base/manage-access">Management</a></li>
            <li><a href="/markdown-knowledge-base/logout">Log out</a></li>
        </ul>
    </div>
    <div class="nav-wrapper hide-on-small-only">
        <a class="right brand-logo" id="logo-a">Markdown Knowledge Base</a>
        <ul id="nav-pc" class="left">
            <li><a href="/markdown-knowledge-base">Home</a></li>
            <li><a class="active">Add new article</a></li>
            <li><a href="/markdown-knowledge-base/manage-access">Management</a></li>
            <li><a href="/markdown-knowledge-base/logout">Log out</a></li>
        </ul>
    </div>
</nav>

<div id="content">
    <div class="row center inputs">
        <form action="" method="post" id="markdown-form">
            <div class="input-field col s12 m11">
                {{#edit_title}}
                <input type="text" id="markdown-title" name="title" value="{{edit_title}}" required/>
                {{/edit_title}}
                {{^edit_title}}
                <input type="text" id="markdown-title" name="title" required/>
                {{/edit_title}}
            </div>
            <label class="col s12 m11" id="markdown-input-label">
                {{#edit_text}}
                <textarea id="markdown-input" name="markdown">{{edit_text}}</textarea>
                {{/edit_text}}
                {{^edit_text}}
                <textarea id="markdown-input" name="markdown"># Article text</textarea>
                {{/edit_text}}
            </label>
            <button type="submit" class="btn-floating btn-large waves-effect waves-light indigo right col"
                    id="submit-btn-create">
                <i class="material-icons">done</i>
            </button>
            <button type="button"
                    class="btn-floating btn-large waves-effect waves-light indigo right col modal-trigger"
                    id="btn-preview" onclick="showPreview()">
                <i class="material-icons">remove_red_eye</i>
            </button>
            <div class="input-field col s12 m11" id="path-select-wrapper">
                <select id="path-select" name="path">
                    {{#available_folders}}
                    <option value="{{.}}">{{.}}</option>
                    {{/available_folders}}
                </select>
                <label for="path-select" id="path-select-label">Choose one of existing paths for where to place the article</label>
            </div>
            <div class="input-field col s12 m11">
                <input type="text" data-length="10" id="new-folder-input" name="new_path"/>
                <label for="new-folder-input">Or add new path for article</label>
            </div>
            <div class="input-field col s12 m11" id="select-roles-wrapper">
                <select multiple name="roles" id="select-roles">
                    {{#available_roles}}
                    <option value="{{.}}">{{.}}</option>
                    {{/available_roles}}
                </select>
                <label for="select-roles">Choose one or several roles from existing</label>
            </div>
            <div class="input-field col s12 m11 left-align" id="chips-wrapper">
                <input name="new_roles" type="tags" placeholder="Comma separated string with roles"/>
                <label class="chips-placeholder-label">Or add new roles</label>
            </div>
        </form>
    </div>
</div>

<div id="preview-modal" class="modal modal-fixed-footer">
    <div class="modal-content center">
        <article class="page-content g-10 page-article left-align" id="preview-modal-content" style="width: 80%">
        </article>
    </div>
    <div class="modal-footer">
        <a class="modal-close waves-effect waves-green btn-flat">Close preview</a>
    </div>
</div>

<!-- Scripts -->
<script type="application/javascript" src="/markdown-knowledge-base/site/js/jquery-3.3.1.min.js"></script>
<script type="application/javascript" src="/markdown-knowledge-base/site/js/tags-input.js"></script>
<script type="application/javascript" src="/markdown-knowledge-base/site/js/init-tags-input.js"></script>
<script type="application/javascript" src="/markdown-knowledge-base/markdown/js/nav.js"></script>
<script type="application/javascript" src="/markdown-knowledge-base/materialize/js/materialize.min.js"></script>
<script type="application/javascript" src="/markdown-knowledge-base/materialize/js/init-select-multiple.js"></script>
<script type="application/javascript" src="/markdown-knowledge-base/codemirror/js/codemirror.min.js"></script>
<script type="application/javascript" src="/markdown-knowledge-base/codemirror/js/mode/markdown.min.js"></script>
<script type="application/javascript" src="/markdown-knowledge-base/codemirror/js/init_editable_code_highlight.js"></script>
<script>
  $(document).ready(() => {
    $('.modal').modal()

    initTagsInput()

    {{#edit_mode}}

    // path
    let editPage = 'option[value="' + "{{edit_path}}".replace(/&#x2F;/g, '/') + '"]';
    $(editPage).attr('selected', '')
    $('#path-select').formSelect()

    // roles
    {{#edit_roles}}
    $('#{{.}}').attr('selected', '')
    {{/edit_roles}}
    $('#select-roles').formSelect()
    {{/edit_mode}}

    })

  function showPreview () {
    $.post('/markdown-knowledge-base/preview', {
      markdown: editor.getValue()
    }).done((data) => {
      $('#preview-modal').modal('open')
      $('#preview-modal-content').html(data.html)

      console.log(JSON.stringify(data, null, 4))
    })
  }
</script>
<script>$('.sidenav').sidenav()</script>
</body>
</html>